// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: cart.sql

package dbpg

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const addCartItem = `-- name: AddCartItem :one
INSERT INTO cart_items (cart_session_id, service_id, vehicle_id, quantity)
VALUES ($1, $2, $3, $4)
RETURNING id, cart_session_id, service_id, vehicle_id, quantity, created_at
`

type AddCartItemParams struct {
	CartSessionID int64
	ServiceID     int64
	VehicleID     pgtype.Int8
	Quantity      int32
}

func (q *Queries) AddCartItem(ctx context.Context, arg AddCartItemParams) (CartItem, error) {
	row := q.db.QueryRow(ctx, addCartItem,
		arg.CartSessionID,
		arg.ServiceID,
		arg.VehicleID,
		arg.Quantity,
	)
	var i CartItem
	err := row.Scan(
		&i.ID,
		&i.CartSessionID,
		&i.ServiceID,
		&i.VehicleID,
		&i.Quantity,
		&i.CreatedAt,
	)
	return i, err
}

const addCartItemOption = `-- name: AddCartItemOption :one
INSERT INTO cart_item_options (cart_item_id, service_option_id)
VALUES ($1, $2)
RETURNING id, cart_item_id, service_option_id
`

type AddCartItemOptionParams struct {
	CartItemID      int64
	ServiceOptionID int64
}

func (q *Queries) AddCartItemOption(ctx context.Context, arg AddCartItemOptionParams) (CartItemOption, error) {
	row := q.db.QueryRow(ctx, addCartItemOption, arg.CartItemID, arg.ServiceOptionID)
	var i CartItemOption
	err := row.Scan(&i.ID, &i.CartItemID, &i.ServiceOptionID)
	return i, err
}

const clearCart = `-- name: ClearCart :exec
DELETE FROM cart_items
WHERE cart_session_id = $1
`

type ClearCartParams struct {
	CartSessionID int64
}

func (q *Queries) ClearCart(ctx context.Context, arg ClearCartParams) error {
	_, err := q.db.Exec(ctx, clearCart, arg.CartSessionID)
	return err
}

const createCartSession = `-- name: CreateCartSession :one
INSERT INTO cart_sessions (user_id, session_token, expires_at)
VALUES ($1, $2, $3)
RETURNING id, user_id, session_token, expires_at, created_at
`

type CreateCartSessionParams struct {
	UserID       pgtype.Int8
	SessionToken string
	ExpiresAt    pgtype.Timestamptz
}

func (q *Queries) CreateCartSession(ctx context.Context, arg CreateCartSessionParams) (CartSession, error) {
	row := q.db.QueryRow(ctx, createCartSession, arg.UserID, arg.SessionToken, arg.ExpiresAt)
	var i CartSession
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.SessionToken,
		&i.ExpiresAt,
		&i.CreatedAt,
	)
	return i, err
}

const getCartBySessionToken = `-- name: GetCartBySessionToken :one
SELECT id, user_id, session_token, expires_at, created_at FROM cart_sessions
WHERE session_token = $1
  AND expires_at > NOW()
`

type GetCartBySessionTokenParams struct {
	SessionToken string
}

func (q *Queries) GetCartBySessionToken(ctx context.Context, arg GetCartBySessionTokenParams) (CartSession, error) {
	row := q.db.QueryRow(ctx, getCartBySessionToken, arg.SessionToken)
	var i CartSession
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.SessionToken,
		&i.ExpiresAt,
		&i.CreatedAt,
	)
	return i, err
}

const getCartByUserID = `-- name: GetCartByUserID :one
SELECT id, user_id, session_token, expires_at, created_at FROM cart_sessions
WHERE user_id = $1
  AND expires_at > NOW()
ORDER BY created_at DESC
LIMIT 1
`

type GetCartByUserIDParams struct {
	UserID pgtype.Int8
}

func (q *Queries) GetCartByUserID(ctx context.Context, arg GetCartByUserIDParams) (CartSession, error) {
	row := q.db.QueryRow(ctx, getCartByUserID, arg.UserID)
	var i CartSession
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.SessionToken,
		&i.ExpiresAt,
		&i.CreatedAt,
	)
	return i, err
}

const listCartItems = `-- name: ListCartItems :many
SELECT ci.id, ci.cart_session_id, ci.service_id, ci.vehicle_id,
       ci.quantity, ci.created_at,
       s.name AS service_name, s.base_price AS service_price
FROM cart_items ci
JOIN services s ON s.id = ci.service_id
WHERE ci.cart_session_id = $1
ORDER BY ci.created_at
`

type ListCartItemsParams struct {
	CartSessionID int64
}

type ListCartItemsRow struct {
	ID            int64
	CartSessionID int64
	ServiceID     int64
	VehicleID     pgtype.Int8
	Quantity      int32
	CreatedAt     pgtype.Timestamptz
	ServiceName   string
	ServicePrice  int64
}

func (q *Queries) ListCartItems(ctx context.Context, arg ListCartItemsParams) ([]ListCartItemsRow, error) {
	rows, err := q.db.Query(ctx, listCartItems, arg.CartSessionID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListCartItemsRow
	for rows.Next() {
		var i ListCartItemsRow
		if err := rows.Scan(
			&i.ID,
			&i.CartSessionID,
			&i.ServiceID,
			&i.VehicleID,
			&i.Quantity,
			&i.CreatedAt,
			&i.ServiceName,
			&i.ServicePrice,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const removeCartItem = `-- name: RemoveCartItem :exec
DELETE FROM cart_items
WHERE id = $1
`

type RemoveCartItemParams struct {
	ID int64
}

func (q *Queries) RemoveCartItem(ctx context.Context, arg RemoveCartItemParams) error {
	_, err := q.db.Exec(ctx, removeCartItem, arg.ID)
	return err
}

const removeCartItemOption = `-- name: RemoveCartItemOption :exec
DELETE FROM cart_item_options
WHERE cart_item_id = $1 AND service_option_id = $2
`

type RemoveCartItemOptionParams struct {
	CartItemID      int64
	ServiceOptionID int64
}

func (q *Queries) RemoveCartItemOption(ctx context.Context, arg RemoveCartItemOptionParams) error {
	_, err := q.db.Exec(ctx, removeCartItemOption, arg.CartItemID, arg.ServiceOptionID)
	return err
}

const updateCartItemQuantity = `-- name: UpdateCartItemQuantity :one
UPDATE cart_items
SET quantity = $2
WHERE id = $1
RETURNING id, cart_session_id, service_id, vehicle_id, quantity, created_at
`

type UpdateCartItemQuantityParams struct {
	ID       int64
	Quantity int32
}

func (q *Queries) UpdateCartItemQuantity(ctx context.Context, arg UpdateCartItemQuantityParams) (CartItem, error) {
	row := q.db.QueryRow(ctx, updateCartItemQuantity, arg.ID, arg.Quantity)
	var i CartItem
	err := row.Scan(
		&i.ID,
		&i.CartSessionID,
		&i.ServiceID,
		&i.VehicleID,
		&i.Quantity,
		&i.CreatedAt,
	)
	return i, err
}
